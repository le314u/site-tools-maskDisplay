<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Conversor IP e Máscara</title>

  <!-- Materialize CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet" />

  <style>
    body { background:#0d1117; color:white; }
    .card { background:#161b22 !important; }
    .binary-box {
      font-family: monospace;
      padding: 12px;
      background: rgba(255,255,255,0.13);
      border-radius: 6px;
      margin-top:10px;
      width:100%;
      text-align:center;
      word-break:break-all;
      font-size:14px;
    }
    .octet-wrapper {
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:16px;
      margin-bottom:22px;
      min-height:140px;
    }
    .octet-number {
      font-size: 13px;
      color:#222;
      margin-bottom:4px;
    }
    #input{
      color:white;
    }
    #maskInput{
      color:white;
    }
    .octet-decimal { font-size:16px; font-weight:600; }
  </style>
</head>
<body>
  <div class="container">
    <h4 class="center">Conversor IP → Binário + Máscara</h4>

    <div class="card">
      <div class="card-content">
        <div class="row">
          <div class="input-field col s12 m6">
            <input id="input" type="text" placeholder="192.168.0.10/24 ou 192.168.0.10 255.255.255.0" />
            <label for="input"  class="active">IP + máscara</label>
          </div>

          <div class="input-field col s12 m4">
            <input id="maskInput" type="text" placeholder="/24 ou 255.255.255.0" />
            <label for="maskInput"  class="active">Máscara (opcional)</label>
          </div>

          <div class="col s12 m2">
            <button id="btn" class="btn purple darken-2 waves-effect waves-light" style="width:100%; margin-top:20px;">Converter</button>
          </div>
        </div>

        <div id="error" class="red-text"></div>

        <h5>IP em Decimal + Binário</h5>
        <div id="ipBox" class="row">Nenhum dado ainda</div>

        <h5>Máscara</h5>
        <div id="maskBox" class="row">Nenhum dado ainda</div>

      </div>
    </div>
  </div>

  <script>
    const $ = id => document.getElementById(id);
    const pad8 = n => n.toString(2).padStart(8, '0');

    function ipToArr(ip){
      const p = ip.trim().split('.');
      if(p.length !== 4) return null;
      const n = p.map(Number);
      if(n.some(x => x < 0 || x > 255 || isNaN(x))) return null;
      return n;
    }

    function prefixToMask(prefix){
      if(prefix < 0 || prefix > 32) return null;
      const m = prefix === 0 ? 0 : (0xFFFFFFFF << (32-prefix)) >>> 0;
      return [ (m>>>24)&255, (m>>>16)&255, (m>>>8)&255, m&255 ];
    }

    function maskArrToPrefix(arr){
      const b = arr.map(pad8).join('');
      return b.indexOf('0') === -1 ? 32 : b.slice(0, b.indexOf('0')).length;
    }

    function parse(rawIP, rawMask){
      rawIP = rawIP.trim(); rawMask = rawMask.trim();
      if(!rawIP) return {error:"Digite um IP válido."};

      let ipPart = rawIP;
      let prefix = null;
      let maskArr = null;

      if(rawIP.includes('/')){
        const [base, p] = rawIP.split('/');
        ipPart = base;
        prefix = Number(p);
      }

      if(rawMask.startsWith('/')) prefix = Number(rawMask.slice(1));
      else if(rawMask.includes('.')){
        maskArr = ipToArr(rawMask);
        if(!maskArr) return {error:"Máscara inválida"};
        prefix = maskArrToPrefix(maskArr);
      }

      if(ipPart.includes(' ')){
        const parts = ipPart.split(' ').filter(Boolean);
        ipPart = parts[0];
        if(parts[1]){
          if(parts[1].includes('.')){
            maskArr = ipToArr(parts[1]);
            prefix = maskArrToPrefix(maskArr);
          } else if(parts[1].startsWith('/')) prefix = Number(parts[1].slice(1));
          else prefix = Number(parts[1]);
        }
      }

      const ipArr = ipToArr(ipPart);
      if(!ipArr) return {error:"IP inválido."};

      if(prefix === null || prefix < 0 || prefix > 32) return {error:"Prefixo inválido."};

      return { ip: ipArr, prefix, mask: prefixToMask(prefix) };
    }

    function render(r){
      const boxIP = $('ipBox');
      const boxMask = $('maskBox');
      const err = $('error');

      err.textContent = "";
      if(r.error){ err.textContent = r.error; boxIP.textContent=""; boxMask.textContent=""; return; }

      // Render IP decimal + binário
      boxIP.innerHTML = '';
      r.ip.forEach((o,i)=>{
        boxIP.innerHTML += `
          <div class='col s6 m3 octet-wrapper'>
            <div class='octet-number'>Octeto ${i+1}</div>
            <div class='octet-decimal'>${o}</div>
            <div class='binary-box'>${pad8(o)}</div>
          </div>`;
      });

      // Render máscara
      const dotted = r.mask.join('.')
      boxMask.innerHTML = `
        <div class='col s12'>Prefixo: <b>/${r.prefix}</b></div>
        <div class='col s12'>Máscara decimal: <b>${dotted}</b></div>
        <div class='col s12 row'>
          ${r.mask.map((m,i)=>`
            <div class='col s6 m3 octet-wrapper'>
              <div class='octet-number'>Octeto ${i+1}</div>
              <div class='octet-decimal'>${m}</div>
              <div class='binary-box'>${pad8(m)}</div>
            </div>`).join('')}
        </div>`;
    }

    $('btn').addEventListener('click', ()=>{
      render(parse($('input').value, $('maskInput').value));
    });

  </script>

</body>
</html>
